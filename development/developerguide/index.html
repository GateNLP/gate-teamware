<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developer guide | GATE Teamware Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Documentation for GATE Teamware">
    
    <link rel="preload" href="/gate-teamware/development/assets/css/0.styles.a854f28f.css" as="style"><link rel="preload" href="/gate-teamware/development/assets/js/app.ced2b284.js" as="script"><link rel="preload" href="/gate-teamware/development/assets/js/2.8f6bea6c.js" as="script"><link rel="preload" href="/gate-teamware/development/assets/js/4.b4579c1a.js" as="script"><link rel="preload" href="/gate-teamware/development/assets/js/15.df9e3ffe.js" as="script"><link rel="prefetch" href="/gate-teamware/development/assets/js/10.7f23586b.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/11.fc6c5a2d.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/12.9ffe6c7d.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/13.deb639b1.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/14.49bafa3c.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/16.318f0cab.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/17.3ef214ce.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/18.a884b41e.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/19.9aacf703.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/20.32f32469.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/21.97621e79.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/22.6efbd35b.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/3.d46695be.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/5.163243ca.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/6.1b1b2f4d.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/7.c7c97097.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/8.69c7cf55.js"><link rel="prefetch" href="/gate-teamware/development/assets/js/9.0b73cb97.js">
    <link rel="stylesheet" href="/gate-teamware/development/assets/css/0.styles.a854f28f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/gate-teamware/development/" class="home-link router-link-active"><!----> <span class="site-name">GATE Teamware Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gate-teamware/development/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/gate-teamware/development/annotatorguide/" class="nav-link">
  Annotators
</a></div><div class="nav-item"><a href="/gate-teamware/development/manageradminguide/" class="nav-link">
  Managers &amp; Admins
</a></div><div class="nav-item"><a href="/gate-teamware/development/developerguide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Developer
</a></div> <!----></nav> <div style="font-weight:bold !important;" data-v-266824e4><select class="custom-select" data-v-266824e4><option value="/gate-teamware/0.3.0/">0.3.0</option><option selected="selected" value="/gate-teamware/development/">development</option></select></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gate-teamware/development/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/gate-teamware/development/annotatorguide/" class="nav-link">
  Annotators
</a></div><div class="nav-item"><a href="/gate-teamware/development/manageradminguide/" class="nav-link">
  Managers &amp; Admins
</a></div><div class="nav-item"><a href="/gate-teamware/development/developerguide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Developer
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/gate-teamware/development/developerguide/" aria-current="page" class="active sidebar-link">Developer guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#installation-for-development" class="sidebar-link">Installation for development</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#updating-packages" class="sidebar-link">Updating packages</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#development-server" class="sidebar-link">Development server</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#deployment-using-docker" class="sidebar-link">Deployment using Docker</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#deployment-using-kubernetes" class="sidebar-link">Deployment using Kubernetes</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/development/developerguide/#configuration" class="sidebar-link">Configuration</a></li></ul></li><li><a href="/gate-teamware/development/developerguide/testing.html" class="sidebar-link">Testing</a></li><li><a href="/gate-teamware/development/developerguide/releases.html" class="sidebar-link">Managing Releases</a></li><li><a href="/gate-teamware/development/developerguide/documentation.html" class="sidebar-link">Managing and versioning documentation</a></li><li><a href="/gate-teamware/development/developerguide/api_docs.html" class="sidebar-link">API Documentation</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="developer-guide"><a href="#developer-guide" class="header-anchor">#</a> Developer guide</h1> <h2 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h2> <div class="language- extra-class"><pre class="language-text"><code>├── .github/workflows/    # github actions workflow files
├── teamware/             # Django project
│   └── settings/
├── backend/              # Django app
├── charts/               # Helm charts for Kubernetes
├── cypress/              # integration test configurations
├── docs/                 # documentation
├── examples/             # example data files
├── frontend/             # all frontend, in VueJS framework
├── nginx/                # Nginx configurations
|
# Top level directory contains scripts for management and deployment,
# main project package.json, python requirements, docker configs
├── build-images.sh
├── deploy.sh
├── create-django-db.sh
├── docker-compose.yml
├── Dockerfile
├── generate-docker-env.sh
├── manage.py
├── migrate-integration.sh
├── package.json
├── package-lock.json
├── pytest.ini
├── README.md
├── requirements-dev.txt
├── requirements.txt
└── run-server.sh

</code></pre></div><h2 id="installation-for-development"><a href="#installation-for-development" class="header-anchor">#</a> Installation for development</h2> <p>The service depends on a combination of python and javascript libraries. We recommend developing inside a <code>conda</code> conda environment as it is able to install
python libraries and nodejs which is used to install javascript libraries.</p> <ul><li>Install anaconda/miniconda</li> <li>Create a blank virtual conda env<div class="language-bash extra-class"><pre class="language-bash"><code>$ conda create -n teamware <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.9</span>
</code></pre></div></li> <li>Activate conda environment<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">source</span> activate teamware
<span class="token comment"># or</span>
$ conda activate teamware
</code></pre></div></li> <li>Install python dependencies in conda environment using pip<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ pip <span class="token function">install</span> -r requirements.txt -r requirements-dev.txt
</code></pre></div></li> <li>Install nodejs, postgresql and openssl in the conda environment<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ conda <span class="token function">install</span> -y -c conda-forge <span class="token assign-left variable">postgresql</span><span class="token operator">=</span><span class="token number">14</span>.*
<span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ conda <span class="token function">install</span> -y -c conda-forge <span class="token assign-left variable">nodejs</span><span class="token operator">=</span><span class="token number">14</span>.*
</code></pre></div></li> <li>Install nodejs dependencies<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div></li></ul> <p>Set up a new postgreSQL database and user for development:</p> <div class="language- extra-class"><pre class="language-text"><code># Create a new directory for the db data and initialise
mkdir -p pgsql/data
initdb -D pgsql/data

# Launch postgres in the background
postgres -p 5432 -D pgsql/data &amp;

# Create a DB user, you'll be prompted to input password, &quot;password&quot; is the default in teamware/settings/base.py for development
createuser -p 5432 -P user --createdb

# Create a rumours_db with rumours as user
createdb -p 5432 -O user teamware_db

# Migrate &amp; create database tables
python manage.py migrate

# create a new superuser - when prompted enter a username and password for the db superuser
python manage.py createsuperuser
</code></pre></div><h2 id="updating-packages"><a href="#updating-packages" class="header-anchor">#</a> Updating packages</h2> <p>To update packages after a merge, run the following commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Activate the conda environment</span>
<span class="token builtin class-name">source</span> activate teamware
<span class="token comment"># Update any packages changed in the python requirements.txt and requirements-dev.txt files</span>
pip <span class="token function">install</span> -r requirements.txt -r requirements-dev.txt
<span class="token comment"># Update any packages changed in package.json</span>
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><h2 id="development-server"><a href="#development-server" class="header-anchor">#</a> Development server</h2> <p>The application uses django's dev server to serve page contents and run the RPC API, it also uses Vue CLI's
development server to serve dynamic assets such as javascript or stylesheets allowing for hot-reloading
during development.</p> <p>To run both servers together:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve
</code></pre></div><p>To run separately:</p> <ul><li>Django server<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve:backend
</code></pre></div></li> <li>Vue CLI dev server<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve:frontend
</code></pre></div></li></ul> <h2 id="deployment-using-docker"><a href="#deployment-using-docker" class="header-anchor">#</a> Deployment using Docker</h2> <p>Teamware can be deployed via <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">docker-compose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, using <a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">NGINX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to serve static content, a separate <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener noreferrer">postgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> service containing the database and a database backup service (see <code>docker-compose.yml</code> for details).</p> <ol><li><p>Run <code>./generate-docker-env.sh</code> to create a <code>.env</code> file containing randomly generated secrets which are mounted as environment variables into the container. See <a href="#env-config">below</a> for details.</p></li> <li><p>Then build the images via:</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./build-images.sh
</code></pre></div><ol start="3"><li>then deploy the stack with</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./deploy.sh production <span class="token comment"># (or prod) to deploy with production settings</span>
./deploy.sh staging <span class="token comment"># (or stag) to deploy with staging settings</span>
</code></pre></div><p>To bring the stack down, run <code>docker-compose down</code>, using the <code>-v</code> flag to destroy the database volume (be careful with this).</p> <h3 id="configuration-using-environment-variables-env-file"><a href="#configuration-using-environment-variables-env-file" class="header-anchor">#</a> Configuration using environment variables (.env file)<a id="env-config"></a></h3> <p>To allow the app to be easily configured between instances especially inside containers, many of the app's configuration can be done through environment variables.</p> <p>Run <code>./generate-docker-env.sh</code> to generate a <code>.env</code> file with all configurable environment parameters.</p> <p>To set values for your own deployment, add values to the variables in <code>.env</code>, most existing values will be kept after running <code>generate-docker-env.sh</code>, see comments in <code>.env</code> for specific details. Anything that is left blank will be filled with a default value. Passwords and keys are filled with auto-generated random values.</p> <p>Existing <code>.env</code> files are copied into a new file named <code>saved-env.&lt;DATE-TIME&gt;</code> by <code>generate-docker-env.sh</code>.</p> <h3 id="backups"><a href="#backups" class="header-anchor">#</a> Backups</h3> <p>In a docker-compose based deployment, backups of the database are managed by the service <code>pgbackups</code> which uses the <a href="https://hub.docker.com/r/prodrigestivill/postgres-backup-local" target="_blank" rel="noopener noreferrer"><code>prodrigestivill/postgres-backup-local:12</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> image.
By default, backups are taken of the database daily, and the <code>docker-compose.yml</code> contains settings for the number of backups kept under the options for the <code>pgbackups</code> service.
Backups are stored as a gzipped SQL dump from the database.</p> <h4 id="taking-a-manual-backup"><a href="#taking-a-manual-backup" class="header-anchor">#</a> Taking a manual backup</h4> <p>A shell script is provided for manually triggering a backup snapshot.
From the main project directory run</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ ./backup_manual.sh
</code></pre></div><p>This uses the <code>pgbackups</code> service and all settings and envrionment variables it is configured with in <code>docker-compose.yml</code>, so backups will be taken to the same location as configured for the main backup schedule.</p> <h4 id="restoring-from-a-backup"><a href="#restoring-from-a-backup" class="header-anchor">#</a> Restoring from a backup</h4> <ol><li>Locate the backup file (<code>*.sql.gz</code>) on your system that you would like to restore from.</li> <li>Make sure that the stack is down, from the main project directory run <code>docker-commpose down</code>.</li> <li>Run the backup restore shell script, passing in the path to your backup file as the only argument:</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>$ ./backup_restore.sh path/to/my/backup.sql.gz
</code></pre></div><p>This will first launch the database container, then via Django's <code>dbshell</code> command, running in the <code>backend</code> service, execute a number of SQL commands before and after running all the SQL from the backup file.</p> <ol start="4"><li>Redeploy the stack, via <code>./deploy.sh staging</code> or <code>./deploy.sh production</code>, whichever is the case.</li> <li>The database <em>should</em> be restored.</li></ol> <h2 id="deployment-using-kubernetes"><a href="#deployment-using-kubernetes" class="header-anchor">#</a> Deployment using Kubernetes</h2> <p>A Helm chart to deploy Teamware on Kubernetes is published to the GATE team public charts repository.  The chart requires <a href="https://helm.sh" target="_blank" rel="noopener noreferrer">Helm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> version 3.7 or later, and is compatible with Kubernetes version 1.23 or later.  Earlier Kubernetes versions back to 1.19 <em>may</em> work provided autoscaling is not enabled, but these have not been tested.</p> <p>The following quick start instructions assume you have a compatible Kubernetes cluster and a working installation of <code>kubectl</code> and <code>helm</code> (3.7 or later) with permission to create all the necessary resource types in your target namespace.</p> <p>First generate a random &quot;secret key&quot; for the Django application.  This must be at least 50 random characters, a quick way to do this is</p> <div class="language- extra-class"><pre class="language-text"><code># 42 random bytes base64 encoded becomes 56 random characters
kubectl create secret generic -n {namespace} django-secret \
   --from-literal=&quot;secret-key=$( openssl rand -base64 42 )&quot;
</code></pre></div><p>Add the GATE charts repository to your Helm configuration:</p> <div class="language- extra-class"><pre class="language-text"><code>helm repo add gate https://repo.gate.ac.uk/repository/charts
helm repo update
</code></pre></div><p>Create a <code>values.yaml</code> file with the key settings required for teamware.  The following is a minimal set of values for a typical installation:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Public-facing web hostname of the teamware application, the public</span>
<span class="token comment"># URL will be https://{hostName}</span>
<span class="token key atrule">hostName</span><span class="token punctuation">:</span> teamware.example.com

<span class="token key atrule">email</span><span class="token punctuation">:</span>
  <span class="token comment"># &quot;From&quot; address on emails sent by Teamware</span>
  <span class="token key atrule">adminAddress</span><span class="token punctuation">:</span> admin@teamware.example.com
  <span class="token comment"># Send email via an SMTP server - alternatively &quot;gmail&quot; to use GMail API</span>
  <span class="token key atrule">backend</span><span class="token punctuation">:</span> <span class="token string">&quot;smtp&quot;</span>
  <span class="token key atrule">smtp</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> mail.example.com
    <span class="token comment"># You will also need to set user and passwordSecret if your</span>
    <span class="token comment"># mail server requires authentication</span>

<span class="token key atrule">privacyPolicy</span><span class="token punctuation">:</span>
<span class="token comment"># Contact details of the host and administrator of the teamware instance, if no admin defined, defaults to the host values.</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span>
    <span class="token comment"># Name of the host</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Service Host&quot;</span>
    <span class="token comment"># Host's physical address</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;123 Example Street, City. Country.&quot;</span>
    <span class="token comment"># A method of contacting the host, field supports HTML for e.g. linking to a form</span>
    <span class="token key atrule">contact</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;a href='mailto:info@examplehost.com'&gt;Email&lt;/a&gt;&quot;</span>
  <span class="token key atrule">admin</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Dr. Service Admin&quot;</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">&quot;Department of Example Studies, University of Example, City. Country.&quot;</span>
    <span class="token key atrule">contact</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;a href='mailto:s.admin@example.ac.uk'&gt;Email&lt;/a&gt;&quot;</span>

<span class="token key atrule">backend</span><span class="token punctuation">:</span>
  <span class="token comment"># Name of the random secret you created above</span>
  <span class="token key atrule">djangoSecret</span><span class="token punctuation">:</span> django<span class="token punctuation">-</span>secret

<span class="token comment"># Initial &quot;super user&quot; created on the first install.  These are just</span>
<span class="token comment"># the *initial* settings, you can (and should!) change the password</span>
<span class="token comment"># once Teamware is up and running</span>
<span class="token key atrule">superuser</span><span class="token punctuation">:</span>
  <span class="token key atrule">email</span><span class="token punctuation">:</span> me@example.com
  <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">password</span><span class="token punctuation">:</span> changeme
</code></pre></div><p>Some of these may be omitted or others may be required depending on the setup of your specific cluster - see the <a href="https://github.com/GateNLP/charts/blob/main/gate-teamware/README.md" target="_blank" rel="noopener noreferrer">chart README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the chart's own values file (which you can retrieve with <code>helm show values gate/gate-teamware</code>) for full details.  In particular these values assume:</p> <ul><li>your cluster has an ingress controller, with a default ingress class configured, and that controller has a default TLS certificate that is compatible with your chosen hostname (e.g. a <code>*.example.com</code> wildcard)</li> <li>your cluster has a default storageClass configured to provision PVCs, and at least 8 GB of available PV capacity</li> <li>you can send email via an SMTP server with no authentication</li> <li>you do not need to back up your PostgreSQL database - the chart does include the option to store backups in Amazon S3 or another compatible object store, see the full README for details</li></ul> <p>Once you have created your values file, you can install the chart or upgrade an existing installation using</p> <div class="language- extra-class"><pre class="language-text"><code>helm upgrade --install gate-teamware gate/gate-teamware \
       --namespace {namespace} --values teamware-values.yaml
</code></pre></div><h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <h3 id="django-settings-files"><a href="#django-settings-files" class="header-anchor">#</a> Django settings files</h3> <p>Django settings are located in <code>teamware/settings</code> folder. The app will use <code>base.py</code> setting by default
and this must be overridden depending on use.</p> <h3 id="database"><a href="#database" class="header-anchor">#</a> Database</h3> <p>A SQLite3 database is used during development and during integration testing.</p> <p>For staging and production, postgreSQL is used, running from a <code>postgres-12</code> docker container. Settings are found in <code>teamware/settings/base.py</code> and <code>deployment.py</code> as well as being set as environment variables by <code>./generate-docker-env.sh</code> and passed to the container as configured in <code>docker-compose.yml</code>.</p> <p>In Kubernetes deployments the PostgreSQL database is installed using the Bitnami <code>postresql</code> public chart.</p> <h3 id="sending-e-mail"><a href="#sending-e-mail" class="header-anchor">#</a> Sending E-mail</h3> <p>It's recommended to specify e-mail configurations through environment variables (<code>.env</code>). As these settings will include username and passwords that should not be tracked by version control.</p> <h4 id="e-mail-using-smtp"><a href="#e-mail-using-smtp" class="header-anchor">#</a> E-mail using SMTP</h4> <p>SMTP is supported as standard in Django, add the following configurations with your own details
to the list of environment variables:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">DJANGO_EMAIL_BACKEND</span><span class="token operator">=</span><span class="token string">'django.core.mail.backends.smtp.EmailBackend'</span>
<span class="token assign-left variable">DJANGO_EMAIL_HOST</span><span class="token operator">=</span><span class="token string">'myserver.com'</span>
<span class="token assign-left variable">DJANGO_EMAIL_PORT</span><span class="token operator">=</span><span class="token number">22</span>
<span class="token assign-left variable">DJANGO_EMAIL_HOST_USER</span><span class="token operator">=</span><span class="token string">'username'</span>
<span class="token assign-left variable">DJANGO_EMAIL_HOST_PASSWORD</span><span class="token operator">=</span><span class="token string">'password'</span>
</code></pre></div><h4 id="e-mail-using-google-api"><a href="#e-mail-using-google-api" class="header-anchor">#</a> E-mail using Google API</h4> <p>The <a href="https://github.com/dolfim/django-gmailapi-backend" target="_blank" rel="noopener noreferrer">django-gmailapi-backend<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library
has been added to allow sending of mail through Google's API as sending through SMTP is disabled as standard.</p> <p>Unlike with SMTP, Google's API requires OAuth authentication which means a project and a credential has to be
created through Google's cloud console.</p> <ul><li>More information on the Gmail API: <a href="https://developers.google.com/gmail/api/guides/sending" target="_blank" rel="noopener noreferrer">https://developers.google.com/gmail/api/guides/sending<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>OAuth credentials for sending emails: <a href="https://github.com/google/gmail-oauth2-tools/wiki/OAuth2DotPyRunThrough" target="_blank" rel="noopener noreferrer">https://github.com/google/gmail-oauth2-tools/wiki/OAuth2DotPyRunThrough<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>This package includes the script linked in the documentation above, which simplifies the setup of the API credentials. The following outlines the key steps:</p> <ol><li>Create a project in the Google developer console, <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">https://console.cloud.google.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Enable the Gmail API</li> <li>Create OAuth 2.0 credentials, you'll likely want to create a <code>Desktop</code></li> <li>Create a valid refresh_token using the helper script included in the package:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>gmail_oauth2 --generate_oauth2_token <span class="token punctuation">\</span>
  --client_id<span class="token operator">=</span><span class="token string">&quot;&lt;client_id&gt;&quot;</span> <span class="token punctuation">\</span>
  --client_secret<span class="token operator">=</span><span class="token string">&quot;&lt;client_secret&gt;&quot;</span> <span class="token punctuation">\</span>
  --scope<span class="token operator">=</span><span class="token string">&quot;https://www.googleapis.com/auth/gmail.send&quot;</span>
</code></pre></div><ol start="5"><li>Add the created credentials and tokens to the environment variable as shown below:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">DJANGO_EMAIL_BACKEND</span><span class="token operator">=</span><span class="token string">'gmailapi_backend.mail.GmailBackend'</span>
<span class="token assign-left variable">DJANGO_GMAIL_API_CLIENT_ID</span><span class="token operator">=</span><span class="token string">'google_assigned_id'</span>
<span class="token assign-left variable">DJANGO_GMAIL_API_CLIENT_SECRET</span><span class="token operator">=</span><span class="token string">'google_assigned_secret'</span>
<span class="token assign-left variable">DJANGO_GMAIL_API_REFRESH_TOKEN</span><span class="token operator">=</span><span class="token string">'google_assigned_token'</span>
</code></pre></div><h4 id="teamware-privacy-policy-and-terms-conditions"><a href="#teamware-privacy-policy-and-terms-conditions" class="header-anchor">#</a> Teamware Privacy Policy and Terms &amp; Conditions</h4> <p>Teamware includes a default privacy policy and terms &amp; conditions, which are required for running the application.</p> <p>The default privacy policy is intended to be compliant with UK GDPR regulations, which may comply with the rights of users of your deployment, however it is your responsibility to ensure that this is the case.</p> <p>If the default privacy policy covers your use case, then you will need to include configuration for a few contact details.</p> <p>Contact details are required for the <strong>host</strong> and the <strong>administrator</strong>: the <strong>host</strong> is the organisation or individual responsible for managing the deployment of the teamware instance and the <strong>administrator</strong> is the organisation or individual responsible for managing users, projects and data on the instance. In many cases these roles will be filled by the same organisation or individual, so in this case specifying just the <strong>host</strong> details is sufficient.</p> <p>For deployment from source, set the following environment variables:</p> <ul><li><code>PP_HOST_NAME</code></li> <li><code>PP_HOST_ADDRESS</code></li> <li><code>PP_HOST_CONTACT</code></li> <li><code>PP_ADMIN_NAME</code></li> <li><code>PP_ADMIN_ADDRESS</code></li> <li><code>PP_ADMIN_CONTACT</code></li></ul> <p>For deployment using docker-compose, set these values in <code>.env</code>.</p> <p>If the host and administrator are the same, you can just set the <code>PP_HOST_*</code> variables above which will be used for both.</p> <h5 id="including-a-custom-privacy-policy-and-or-terms-conditions"><a href="#including-a-custom-privacy-policy-and-or-terms-conditions" class="header-anchor">#</a> Including a custom Privacy Policy and/or Terms &amp; Conditions</h5> <p>If the default privacy policy or terms &amp; conditions do not cover your use case, you can easily replace these with your own documents.</p> <p>If deploying from source, include markdown (<code>.md</code>) files in a <code>custom-policies</code> directory in the project root with the exact names <code>custom-policies/privacy-policy.md</code> and/or <code>custom-policies/terms-and-conditions.md</code> which will be rendered at the corresponding pages on the running web app.  If you are not familiar with the Markdown language there are a number of free WYSIWYG-style editor tools available including <a href="https://stackedit.io/app" target="_blank" rel="noopener noreferrer">StackEdit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (browser based) and <a href="https://www.zettlr.com" target="_blank" rel="noopener noreferrer">Zettlr<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (desktop app).</p> <p>If deploying with docker compose, place the <code>custom-policies</code> directory at the same location as the <code>docker-compose.yml</code> file before running <code>./deploy.sh</code> as above.</p> <p>An example custom privacy policy file contents might look like:</p> <div class="language-md extra-class"><pre class="language-md"><code><span class="token title important"><span class="token punctuation">#</span> Organisation X Teamware Privacy Policy</span>
...
...
<span class="token title important"><span class="token punctuation">##</span> Definitions of Roles and Terminology</span>
...
...
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/gate-teamware/development/developerguide/testing.html">
        Testing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/gate-teamware/development/assets/js/app.ced2b284.js" defer></script><script src="/gate-teamware/development/assets/js/2.8f6bea6c.js" defer></script><script src="/gate-teamware/development/assets/js/4.b4579c1a.js" defer></script><script src="/gate-teamware/development/assets/js/15.df9e3ffe.js" defer></script>
  </body>
</html>
