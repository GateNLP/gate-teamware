<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developer guide | GATE Teamware Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Documentation for GATE Teamware">
    
    <link rel="preload" href="/gate-teamware/assets/css/0.styles.7a366795.css" as="style"><link rel="preload" href="/gate-teamware/assets/js/app.f7b4629f.js" as="script"><link rel="preload" href="/gate-teamware/assets/js/2.ebad50ed.js" as="script"><link rel="preload" href="/gate-teamware/assets/js/10.9a52811c.js" as="script"><link rel="prefetch" href="/gate-teamware/assets/js/11.76200416.js"><link rel="prefetch" href="/gate-teamware/assets/js/12.a00f4167.js"><link rel="prefetch" href="/gate-teamware/assets/js/13.d2da0916.js"><link rel="prefetch" href="/gate-teamware/assets/js/14.bed575c9.js"><link rel="prefetch" href="/gate-teamware/assets/js/15.bfa03309.js"><link rel="prefetch" href="/gate-teamware/assets/js/16.67e66326.js"><link rel="prefetch" href="/gate-teamware/assets/js/17.3fb41ac3.js"><link rel="prefetch" href="/gate-teamware/assets/js/18.56fc352d.js"><link rel="prefetch" href="/gate-teamware/assets/js/3.9d0eaed5.js"><link rel="prefetch" href="/gate-teamware/assets/js/4.db43b7e9.js"><link rel="prefetch" href="/gate-teamware/assets/js/5.0ba5f55a.js"><link rel="prefetch" href="/gate-teamware/assets/js/6.1aa1e80c.js"><link rel="prefetch" href="/gate-teamware/assets/js/7.01d16af9.js"><link rel="prefetch" href="/gate-teamware/assets/js/8.df6166e1.js"><link rel="prefetch" href="/gate-teamware/assets/js/9.f233e930.js">
    <link rel="stylesheet" href="/gate-teamware/assets/css/0.styles.7a366795.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/gate-teamware/" class="home-link router-link-active"><!----> <span class="site-name">GATE Teamware Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/gate-teamware/" aria-current="page" class="sidebar-link">GATE Teamware</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Developer guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/gate-teamware/developerguide/" aria-current="page" class="active sidebar-link">Developer guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#installation-for-development" class="sidebar-link">Installation for development</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#updating-packages" class="sidebar-link">Updating packages</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#development-server" class="sidebar-link">Development server</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#deployment-using-docker" class="sidebar-link">Deployment using Docker</a></li><li class="sidebar-sub-header"><a href="/gate-teamware/developerguide/#configuration" class="sidebar-link">Configuration</a></li></ul></li><li><a href="/gate-teamware/developerguide/testing.html" class="sidebar-link">Testing</a></li><li><a href="/gate-teamware/developerguide/api_docs.html" class="sidebar-link">API Documentation</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="developer-guide"><a href="#developer-guide" class="header-anchor">#</a> Developer guide</h1> <h2 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h2> <div class="language- extra-class"><pre class="language-text"><code>├── .github/workflows/    # github actions workflow files
├── teamware/      # Django project
│   └── settings/
├── backend/              # Django app
├── cypress/              # integration test configurations
├── docs/                 # documentation
├── examples/             # example data files
├── frontend/             # all frontend, in VueJS framework
├── nginx/                # Nginx configurations
|
# Top level directory contains scripts for management and deployment,
# main project package.json, python requirements, docker configs
├── build-images.sh
├── count_superusers.py
├── deploy.sh
├── create-django-db.sh
├── docker-compose.yml
├── Dockerfile
├── generate-env.sh
├── manage.py
├── migrate-integration.sh
├── package.json
├── package-lock.json
├── pytest.ini
├── README.md
├── requirements-dev.txt
├── requirements.txt
└── run-server.sh

</code></pre></div><h2 id="installation-for-development"><a href="#installation-for-development" class="header-anchor">#</a> Installation for development</h2> <p>The service depends on a combination of python and javascript libraries. We recommend developing inside a <code>conda</code> conda environment as it is able to install
python libraries and nodejs which is used to install javascript libraries.</p> <ul><li>Install anaconda/miniconda</li> <li>Create a blank virtual conda env<div class="language-bash extra-class"><pre class="language-bash"><code>$ conda create -n teamware <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.9</span>
</code></pre></div></li> <li>Activate conda environment<div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">source</span> activate teamware
<span class="token comment"># or</span>
$ conda activate teamware
</code></pre></div></li> <li>Install python dependencies in conda environment using pip<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ pip <span class="token function">install</span> -r requirements.txt -r requirements-dev.txt
</code></pre></div></li> <li>Install nodejs, postgresql and openssl in the conda environment<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ conda <span class="token function">install</span> -y -c anaconda postgresql
<span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ conda <span class="token function">install</span> -y -c conda-forge <span class="token assign-left variable">nodejs</span><span class="token operator">=</span><span class="token number">14</span>.*
</code></pre></div></li> <li>Install nodejs dependencies<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">(</span>teamware<span class="token punctuation">)</span>$ <span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div></li></ul> <h2 id="updating-packages"><a href="#updating-packages" class="header-anchor">#</a> Updating packages</h2> <p>To update packages after a merge, run the following commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Activate the conda environment</span>
<span class="token builtin class-name">source</span> activate teamware
<span class="token comment"># Update any packages changed in the python requirements.txt and requirements-dev.txt files</span>
pip <span class="token function">install</span> -r requirements.txt -r requirements-dev.txt
<span class="token comment"># Update any packages changed in package.json</span>
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre></div><h2 id="development-server"><a href="#development-server" class="header-anchor">#</a> Development server</h2> <p>The application uses django's dev server to serve page contents and run the RPC API, it also uses Vue CLI's
development server to serve dynamic assets such as javascript or stylesheets allowing for hot-reloading
during development.</p> <p>To run both servers together:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve
</code></pre></div><p>To run separately:</p> <ul><li>Django server<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve:backend
</code></pre></div></li> <li>Vue CLI dev server<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> run serve:frontend
</code></pre></div></li></ul> <h2 id="deployment-using-docker"><a href="#deployment-using-docker" class="header-anchor">#</a> Deployment using Docker</h2> <p>Deployment is via <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">docker-compose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, using <a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">NGINX<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to serve static content, a separate <a href="https://hub.docker.com/_/postgres" target="_blank" rel="noopener noreferrer">postgreSQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> service containing the database and a database backup service (see <code>docker-compose.yml</code> for details).</p> <ol><li><p>Run <code>./generate-env.sh</code> to create a <code>.env</code> file containing randomly generated secrets which are mounted as environment variables into the container.</p></li> <li><p>Then build the images via:</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./build-images.sh
</code></pre></div><ol start="3"><li>then deploy the stack with</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./deploy.sh production <span class="token comment"># (or prod) to deploy with production settings</span>
./deploy.sh staging <span class="token comment"># (or stag) to deploy with staging settings</span>
</code></pre></div><p>To bring the stack down, run <code>docker-compose down</code>, using the <code>-v</code> flag to destroy the database volume (be careful with this).</p> <h2 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h2> <h3 id="django-settings-files"><a href="#django-settings-files" class="header-anchor">#</a> Django settings files</h3> <p>Django settings are located in <code>teamware/settings</code> folder. The app will use <code>base.py</code> setting by default
and this must be overridden depending on use.</p> <h3 id="database"><a href="#database" class="header-anchor">#</a> Database</h3> <p>A SQLite3 database is used during development and during integration testing.</p> <p>For staging and production, postgreSQL is used, running from a <code>postgres-12</code> docker container. Settings are found in <code>teamware/settings/base.py</code> and <code>deployment.py</code> as well as being set as environment variables by <code>./generate-env.sh</code> and passed to the container as configured in <code>docker-compose.yml</code>.</p> <h3 id="sending-e-mail"><a href="#sending-e-mail" class="header-anchor">#</a> Sending E-mail</h3> <p>It's recommended to specify e-mail configurations inside the <code>secret.py</code> settings file. As these settings will
include username and passwords that should not be tracked by version control.</p> <h4 id="e-mail-using-smtp"><a href="#e-mail-using-smtp" class="header-anchor">#</a> E-mail using SMTP</h4> <p>SMTP is supported as standard in Django, add the following configurations with your own details
to the corresponding settings file:</p> <div class="language-python extra-class"><pre class="language-python"><code>EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">'django.core.mail.backends.smtp.EmailBackend'</span>
EMAIL_HOST <span class="token operator">=</span> <span class="token string">'myserver.com'</span>
EMAIL_PORT <span class="token operator">=</span> <span class="token number">22</span>
EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">'username'</span>
EMAIL_HOST_PASSWORD <span class="token operator">=</span> <span class="token string">'password'</span>
</code></pre></div><h4 id="e-mail-using-google-api"><a href="#e-mail-using-google-api" class="header-anchor">#</a> E-mail using Google API</h4> <p>The <a href="https://github.com/dolfim/django-gmailapi-backend" target="_blank" rel="noopener noreferrer">django-gmailapi-backend<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library
has been added to allow sending of mail through Google's API as sending through SMTP is disabled as standard.</p> <p>Unlike with SMTP, Google's API requires OAuth authentication which means a project and a credential has to be
created through Google's cloud console.</p> <ul><li>More information on the Gmail API: <a href="https://developers.google.com/gmail/api/guides/sending" target="_blank" rel="noopener noreferrer">https://developers.google.com/gmail/api/guides/sending<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>OAuth credentials for sending emails: <a href="https://github.com/google/gmail-oauth2-tools/wiki/OAuth2DotPyRunThrough" target="_blank" rel="noopener noreferrer">https://github.com/google/gmail-oauth2-tools/wiki/OAuth2DotPyRunThrough<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>This package includes the script linked in the documentation above, which simplifies the setup of the API credentials. The following outlines the key steps:</p> <ol><li>Create a project in the Google developer console, <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">https://console.cloud.google.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Enable the Gmail API</li> <li>Create OAuth 2.0 credentials, you'll likely want to create a <code>Desktop</code></li> <li>Create a valid refresh_token using the helper script included in the package:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>gmail_oauth2 --generate_oauth2_token <span class="token punctuation">\</span>
  --client_id<span class="token operator">=</span><span class="token string">&quot;&lt;client_id&gt;&quot;</span> <span class="token punctuation">\</span>
  --client_secret<span class="token operator">=</span><span class="token string">&quot;&lt;client_secret&gt;&quot;</span> <span class="token punctuation">\</span>
  --scope<span class="token operator">=</span><span class="token string">&quot;https://www.googleapis.com/auth/gmail.send&quot;</span>
</code></pre></div><ol start="5"><li>Add the created credentials and tokens to the <code>secret.py</code> as shown below:</li></ol> <div class="language-python extra-class"><pre class="language-python"><code>EMAIL_BACKEND <span class="token operator">=</span> <span class="token string">'gmailapi_backend.mail.GmailBackend'</span>
GMAIL_API_CLIENT_ID <span class="token operator">=</span> <span class="token string">'google_assigned_id'</span>
GMAIL_API_CLIENT_SECRET <span class="token operator">=</span> <span class="token string">'google_assigned_secret'</span>
GMAIL_API_REFRESH_TOKEN <span class="token operator">=</span> <span class="token string">'google_assigned_token'</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/gate-teamware/userguide/annotators_management.html" class="prev">
        Annotators management
      </a></span> <span class="next"><a href="/gate-teamware/developerguide/testing.html">
        Testing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/gate-teamware/assets/js/app.f7b4629f.js" defer></script><script src="/gate-teamware/assets/js/2.ebad50ed.js" defer></script><script src="/gate-teamware/assets/js/10.9a52811c.js" defer></script>
  </body>
</html>
